<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>活動房間 - InvoiceSplit</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- 活動資訊區 -->
        <header class="room-header">
            <div class="room-info">
                <h1 id="roomName" class="room-name">載入中...</h1>
                <div class="room-code-wrapper">
                    <span class="room-code-label">代碼：</span>
                    <span id="roomCode" class="room-code">------</span>
                    <button id="copyCodeBtn" class="btn-icon" title="複製代碼">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="room-actions">
                <button id="shareBtn" class="btn btn-outline btn-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    分享
                </button>
                <button id="qrBtn" class="btn btn-outline btn-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                    </svg>
                    QR Code
                </button>
            </div>
        </header>

        <!-- 使用者資訊 -->
        <div class="user-bar">
            <span>您好，<strong id="currentUserName">---</strong></span>
            <span id="userBalance" class="user-balance"></span>
        </div>

        <!-- 頁籤切換 -->
        <nav class="tabs">
            <button class="tab active" data-tab="expenses">費用</button>
            <button class="tab" data-tab="members">成員</button>
            <button class="tab" data-tab="settlement">結算</button>
        </nav>

        <!-- 費用清單頁籤 -->
        <section id="expensesTab" class="tab-content active">
            <button id="addExpenseBtn" class="btn btn-primary btn-block">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                新增費用
            </button>
            <div id="expensesList" class="expenses-list">
                <p class="empty-state">尚無費用記錄</p>
            </div>
        </section>

        <!-- 成員列表頁籤 -->
        <section id="membersTab" class="tab-content">
            <div id="membersList" class="members-list">
                <p class="empty-state">尚無成員</p>
            </div>
        </section>

        <!-- 結算頁籤 -->
        <section id="settlementTab" class="tab-content">
            <div class="settlement-summary">
                <h3>結算摘要</h3>
                <div id="summaryContent" class="summary-content">
                    <p class="empty-state">尚無費用可結算</p>
                </div>
            </div>
            <div class="transfer-guide">
                <h3>轉帳指引</h3>
                <div id="transferList" class="transfer-list">
                    <p class="empty-state">無需轉帳</p>
                </div>
            </div>
        </section>

        <!-- 管理者功能 -->
        <div id="adminSection" class="admin-section hidden">
            <button id="endEventBtn" class="btn btn-danger btn-block">結束活動</button>
        </div>

        <!-- 活動已結束提示 -->
        <div id="endedBanner" class="ended-banner hidden">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            此活動已結束，無法新增或編輯費用
        </div>
    </div>

    <!-- 新增費用 Modal -->
    <div id="expenseModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="expenseModalTitle">新增費用</h2>
                <button class="modal-close" data-close-modal>&times;</button>
            </div>
            <form id="expenseForm" class="form">
                <input type="hidden" id="expenseId">
                <div class="form-group">
                    <label for="expenseTitle">費用名稱</label>
                    <input type="text" id="expenseTitle" placeholder="例如：晚餐" required>
                </div>
                <div class="form-group">
                    <label for="expenseAmount">金額</label>
                    <input type="number" id="expenseAmount" placeholder="0" min="1" required>
                </div>
                <div class="form-group">
                    <label>付款人（可多選，並輸入各自付款金額）</label>
                    <div id="payersCheckbox" class="checkbox-group"></div>
                </div>
                <div id="payerAmounts" class="split-details hidden"></div>
                <div class="form-group">
                    <label>參與者</label>
                    <div id="participantsCheckbox" class="checkbox-group"></div>
                    <button type="button" id="addTempMemberBtn" class="btn btn-link">+ 新增臨時成員</button>
                </div>
                <div class="form-group">
                    <label for="splitMethod">分帳方式</label>
                    <select id="splitMethod">
                        <option value="equal">均分</option>
                        <option value="ratio">依比例</option>
                        <option value="exact">指定金額</option>
                    </select>
                </div>
                <div id="splitDetails" class="split-details hidden"></div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" data-close-modal>取消</button>
                    <button type="submit" class="btn btn-primary">確認</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 新增臨時成員 Modal -->
    <div id="tempMemberModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2>新增臨時成員</h2>
                <button class="modal-close" data-close-modal>&times;</button>
            </div>
            <form id="tempMemberForm" class="form">
                <div class="form-group">
                    <label for="tempMemberName">成員姓名</label>
                    <input type="text" id="tempMemberName" placeholder="輸入姓名" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" data-close-modal>取消</button>
                    <button type="submit" class="btn btn-primary">新增</button>
                </div>
            </form>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2>分享 QR Code</h2>
                <button class="modal-close" data-close-modal>&times;</button>
            </div>
            <div class="qr-container">
                <div id="qrCode"></div>
                <p class="qr-hint">掃描加入活動</p>
            </div>
        </div>
    </div>

    <!-- 結束活動確認 Modal -->
    <div id="endEventModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2>結束活動</h2>
                <button class="modal-close" data-close-modal>&times;</button>
            </div>
            <form id="endEventForm" class="form">
                <p class="text-center mb-3">結束後將無法新增或編輯費用</p>
                <div class="form-group">
                    <label for="endEventPassword">請輸入管理密碼</label>
                    <input type="password" id="endEventPassword" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" data-close-modal>取消</button>
                    <button type="submit" class="btn btn-danger">確認結束</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 付款確認 Modal -->
    <div id="paymentModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2>標記已付款</h2>
                <button class="modal-close" data-close-modal>&times;</button>
            </div>
            <div class="payment-info">
                <p>付給：<strong id="paymentTo">---</strong></p>
                <p>金額：<strong id="paymentAmount">$0</strong></p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-outline" data-close-modal>取消</button>
                <button type="button" id="confirmPaymentBtn" class="btn btn-primary">確認付款</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast hidden"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
