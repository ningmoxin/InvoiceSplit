# 專案規格書 (Project Specification)

## 1. 專案概述

### 1.1 專案名稱
InvoiceSplit

### 1.2 專案目標
透過 index.html 連結 Firebase，建立一個分帳系統，如同 LINE Split 一樣

### 1.3 目標使用者
參與活動的人輸入姓名進入

---

## 2. 功能需求

### 2.1 核心功能

1. **活動管理**
   - 建立活動房間（產生唯一連結/QR Code）
   - 活動建立者為管理者
   - 管理者可結束活動（結束後不可新增費用）
   - 其他人透過連結/QR Code 加入活動

2. **成員管理**
   - 使用者輸入姓名加入活動
   - 可新增不在名單中的參與者（臨時成員）
   - 顯示活動成員列表

3. **費用管理**
   - 新增費用：費用名稱、金額、付款人、參與者
   - 編輯費用（僅建立者可編輯）
   - 刪除費用（僅建立者可刪除）
   - 費用清單依建立時間排序（最新在前）

4. **分帳計算方式**
   - 均分：費用由所有參與者平均分擔
   - 依比例：可設定每人分擔不同比例
   - 指定金額：可直接指定每人應付金額

5. **結算功能**
   - 顯示每人應付總額
   - 顯示每人應收總額
   - 產生詳細轉帳清單（誰該付給誰多少）

6. **付款追蹤**
   - 使用者可標記已付款
   - 系統顯示付款狀態

### 2.2 使用者故事

1. 作為活動發起人，我想要建立一個分帳活動，讓朋友可以加入
2. 作為參與者，我想要透過連結加入活動，只需輸入姓名即可
3. 作為參與者，我想要新增我代墊的費用，並選擇哪些人要分擔
4. 作為參與者，我想要看到我總共應付/應收多少錢
5. 作為參與者，我想要知道具體該轉帳給誰多少錢
6. 作為活動管理者，我想要結束活動，避免有人繼續新增費用

### 2.3 使用流程

```
1. 建立活動
   └─→ 管理者輸入活動名稱 + 管理密碼
   └─→ 系統產生活動連結 & QR Code

2. 加入活動
   └─→ 參與者開啟連結
   └─→ 輸入姓名加入

3. 新增費用
   └─→ 選擇「新增費用」
   └─→ 輸入：費用名稱、金額、付款人
   └─→ 選擇參與者（從成員選 or 新增臨時成員）
   └─→ 選擇分帳方式（均分/比例/指定金額）
   └─→ 確認新增

4. 查看結算
   └─→ 查看個人應付/應收
   └─→ 查看轉帳指引

5. 標記付款
   └─→ 完成轉帳後標記已付款

6. 結束活動（管理者）
   └─→ 輸入管理密碼
   └─→ 確認結束活動
```

---

## 3. 技術規格

### 3.1 技術棧
- **前端**：HTML + CSS + JavaScript（純前端，無框架）
- **後端**：無（Serverless）
- **資料庫**：Firebase Realtime Database
- **其他**：Firebase Hosting（可選）、QR Code 產生器

### 3.2 系統架構

```
┌─────────────────┐
│   index.html    │  ← 首頁：建立/加入活動
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   room.html     │  ← 活動房間：費用管理、結算
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│    Firebase     │  ← Realtime Database
│  Realtime DB    │
└─────────────────┘
```

### 3.3 頁面結構

| 頁面 | 檔案名 | 功能 |
|------|--------|------|
| 首頁 | index.html | 建立活動、輸入活動代碼加入 |
| 活動房間 | room.html | 費用管理、成員列表、結算 |

### 3.4 Firebase 資料結構

```javascript
{
  "rooms": {
    "<roomId>": {
      "info": {
        "name": "活動名稱",
        "createdAt": 1703750400000,
        "createdBy": "建立者姓名",
        "adminPassword": "加密後的管理密碼",
        "status": "active" // active | ended
      },
      "members": {
        "<memberId>": {
          "name": "成員姓名",
          "joinedAt": 1703750400000,
          "isTemp": false // 是否為臨時成員
        }
      },
      "expenses": {
        "<expenseId>": {
          "title": "費用名稱",
          "amount": 1000,
          "paidBy": "<memberId>", // 付款人
          "createdBy": "<memberId>", // 建立者
          "createdAt": 1703750400000,
          "splitMethod": "equal", // equal | ratio | exact
          "participants": {
            "<memberId>": {
              "ratio": 1, // 比例（splitMethod=ratio 時使用）
              "amount": 250 // 金額（splitMethod=exact 時使用）
            }
          }
        }
      },
      "payments": {
        "<paymentId>": {
          "from": "<memberId>", // 付款人
          "to": "<memberId>", // 收款人
          "amount": 500,
          "paidAt": 1703750400000,
          "confirmed": false // 收款人是否確認
        }
      }
    }
  }
}
```

---

## 4. 資料模型

### 4.1 實體定義

**Room（活動房間）**
| 欄位 | 類型 | 說明 |
|------|------|------|
| id | string | 活動 ID（6 碼英數字） |
| name | string | 活動名稱 |
| createdAt | timestamp | 建立時間 |
| createdBy | string | 建立者 ID |
| adminPassword | string | 管理密碼（hash） |
| status | enum | 狀態：active / ended |

**Member（成員）**
| 欄位 | 類型 | 說明 |
|------|------|------|
| id | string | 成員 ID |
| name | string | 姓名 |
| joinedAt | timestamp | 加入時間 |
| isTemp | boolean | 是否為臨時成員 |

**Expense（費用）**
| 欄位 | 類型 | 說明 |
|------|------|------|
| id | string | 費用 ID |
| title | string | 費用名稱 |
| amount | number | 金額 |
| paidBy | string | 付款人 ID |
| createdBy | string | 建立者 ID |
| createdAt | timestamp | 建立時間 |
| splitMethod | enum | 分帳方式：equal / ratio / exact |
| participants | object | 參與者及分擔資訊 |

**Payment（付款記錄）**
| 欄位 | 類型 | 說明 |
|------|------|------|
| id | string | 付款 ID |
| from | string | 付款人 ID |
| to | string | 收款人 ID |
| amount | number | 金額 |
| paidAt | timestamp | 付款時間 |
| confirmed | boolean | 是否確認收款 |

### 4.2 狀態流程

**活動狀態**
```
active（進行中）──[管理者結束]──→ ended（已結束）
```

**付款狀態**
```
pending（待付款）──[標記已付]──→ paid（已付款）──[確認收款]──→ confirmed（已確認）
```

---

## 5. 介面設計

### 5.1 頁面列表

1. **首頁** (index.html)
2. **活動房間** (room.html)

### 5.2 頁面詳細設計

#### 首頁 (index.html)

**功能區塊**
1. 建立新活動
   - 輸入活動名稱
   - 設定管理密碼
   - 輸入您的姓名（自動成為管理者）
   - 建立按鈕

2. 加入活動
   - 輸入活動代碼
   - 輸入您的姓名
   - 加入按鈕

**畫面示意**
```
┌────────────────────────────┐
│       InvoiceSplit         │
│                            │
│  ┌──────────────────────┐  │
│  │   建立新活動          │  │
│  │  ┌────────────────┐  │  │
│  │  │ 活動名稱        │  │  │
│  │  └────────────────┘  │  │
│  │  ┌────────────────┐  │  │
│  │  │ 管理密碼        │  │  │
│  │  └────────────────┘  │  │
│  │  ┌────────────────┐  │  │
│  │  │ 您的姓名        │  │  │
│  │  └────────────────┘  │  │
│  │  [ 建立活動 ]        │  │
│  └──────────────────────┘  │
│                            │
│  ─────── 或 ───────        │
│                            │
│  ┌──────────────────────┐  │
│  │   加入活動            │  │
│  │  ┌────────────────┐  │  │
│  │  │ 活動代碼        │  │  │
│  │  └────────────────┘  │  │
│  │  ┌────────────────┐  │  │
│  │  │ 您的姓名        │  │  │
│  │  └────────────────┘  │  │
│  │  [ 加入活動 ]        │  │
│  └──────────────────────┘  │
└────────────────────────────┘
```

#### 活動房間 (room.html)

**功能區塊**
1. 活動資訊區
   - 活動名稱
   - 活動代碼 & QR Code
   - 分享按鈕

2. 頁籤切換
   - 費用清單
   - 成員列表
   - 結算

3. 費用清單頁籤
   - 新增費用按鈕
   - 費用卡片列表（最新在前）
   - 每張卡片顯示：名稱、金額、付款人、參與人數

4. 成員列表頁籤
   - 成員列表
   - 各成員目前應付/應收

5. 結算頁籤
   - 個人結算摘要
   - 轉帳指引列表
   - 標記已付款功能

6. 管理功能（管理者專用）
   - 結束活動按鈕

**畫面示意**
```
┌────────────────────────────┐
│  聚餐分帳          [分享]   │
│  代碼: ABC123    [QR Code] │
├────────────────────────────┤
│ [費用] [成員] [結算]        │
├────────────────────────────┤
│                            │
│  [ + 新增費用 ]             │
│                            │
│  ┌────────────────────┐    │
│  │ 晚餐         $1,200│    │
│  │ 小明 付款 · 4人均分│    │
│  └────────────────────┘    │
│                            │
│  ┌────────────────────┐    │
│  │ 計程車         $300│    │
│  │ 小華 付款 · 3人均分│    │
│  └────────────────────┘    │
│                            │
└────────────────────────────┘
```

### 5.3 UI/UX 需求

1. **風格**：簡潔現代
2. **響應式**：支援手機與桌面瀏覽
3. **色彩**：使用清爽的配色方案
4. **互動**：按鈕有 hover 效果、適當的 loading 狀態
5. **即時更新**：使用 Firebase 即時監聽，多人同時操作時自動更新

---

## 6. 非功能性需求

### 6.1 效能需求
- 頁面載入時間 < 3 秒
- Firebase 操作回應時間 < 1 秒

### 6.2 安全性需求
- 管理密碼使用 hash 存儲
- Firebase 規則限制讀寫權限

### 6.3 可用性需求
- 支援主流瀏覽器（Chrome、Safari、Firefox、Edge）
- 支援行動裝置操作
- 操作直覺，無需說明即可使用

---

## 7. 限制與假設

### 7.1 已知限制
- 純前端專案，無後端 API
- 依賴 Firebase 服務
- 不支援離線使用

### 7.2 假設條件
- 使用者有網路連線
- 使用者使用現代瀏覽器
- 單一幣別（新台幣）

---

## 8. 里程碑

1. **Phase 1**：基礎架構
   - Firebase 連接
   - 首頁建立/加入活動功能

2. **Phase 2**：核心功能
   - 費用 CRUD
   - 成員管理
   - 基本分帳計算（均分）

3. **Phase 3**：進階功能
   - 多種分帳方式
   - 結算與轉帳指引
   - 付款追蹤

4. **Phase 4**：優化
   - UI 美化
   - QR Code 分享
   - 活動結束功能

---

## 9. 開發前置作業

### 9.1 Firebase 設定 ✅

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyCrrm45SzhPgLtkqspiXkpWC_rb0Q6MnAM",
  authDomain: "matchplay-8a324.firebaseapp.com",
  databaseURL: "https://matchplay-8a324-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "matchplay-8a324",
  storageBucket: "matchplay-8a324.firebasestorage.app",
  messagingSenderId: "477387192568",
  appId: "1:477387192568:web:5cdd491ee498f7ab03e30d"
};
```

### 9.2 管理者密碼 ✅
- 密碼：`admin2025`

### 9.3 部署方式 ✅
- 部署平台：**GitHub Pages**
- 需建立 GitHub repository 並啟用 Pages 功能

---

## 10. 附錄

### 10.1 名詞解釋

| 名詞 | 說明 |
|------|------|
| 活動房間 | 一次分帳活動的容器，包含成員和費用 |
| 管理者 | 活動建立者，擁有結束活動等特殊權限 |
| 臨時成員 | 未透過連結加入，由他人代為新增的成員 |
| 均分 | 費用由參與者平均分擔 |
| 比例分帳 | 依照設定的比例分擔費用 |
| 指定金額 | 直接指定每人應付的金額 |

### 10.2 分帳計算範例

**範例：均分**
- 費用：$1,000
- 參與者：A、B、C、D（4人）
- 每人應付：$1,000 ÷ 4 = $250

**範例：比例分帳**
- 費用：$1,000
- 參與者比例：A=2、B=1、C=1（總比例=4）
- A 應付：$1,000 × 2/4 = $500
- B 應付：$1,000 × 1/4 = $250
- C 應付：$1,000 × 1/4 = $250

**範例：指定金額**
- 費用：$1,000
- A 指定 $400、B 指定 $350、C 指定 $250
- 各付指定金額（總和須等於費用金額）
